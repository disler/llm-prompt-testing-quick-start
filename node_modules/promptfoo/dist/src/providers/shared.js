"use strict";
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.parseChatPrompt = exports.REQUEST_TIMEOUT_MS = void 0;
const js_yaml_1 = __importDefault(require("js-yaml"));
exports.REQUEST_TIMEOUT_MS = process.env.REQUEST_TIMEOUT_MS
    ? parseInt(process.env.REQUEST_TIMEOUT_MS, 10)
    : 300000;
function parseChatPrompt(prompt, defaultValue) {
    const trimmedPrompt = prompt.trim();
    if (trimmedPrompt.startsWith('- role:')) {
        try {
            // Try YAML - some legacy OpenAI prompts are YAML :(
            return js_yaml_1.default.load(prompt);
        }
        catch (err) {
            throw new Error(`Chat Completion prompt is not a valid YAML string: ${err}\n\n${prompt}`);
        }
    }
    else {
        try {
            // Try JSON
            return JSON.parse(prompt);
        }
        catch (err) {
            if (process.env.PROMPTFOO_REQUIRE_JSON_PROMPTS ||
                trimmedPrompt.startsWith('{') ||
                trimmedPrompt.startsWith('[')) {
                throw new Error(`Chat Completion prompt is not a valid JSON string: ${err}\n\n${prompt}`);
            }
            // Fall back to the provided default value
            return defaultValue;
        }
    }
}
exports.parseChatPrompt = parseChatPrompt;
//# sourceMappingURL=shared.js.map